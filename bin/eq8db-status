#!/usr/bin/env node

'use strict';

const program = require('commander');

const pkg = require('../package.json');

/**
 * Program Options
 */
program
	.description('Show the status of the eq8db stack in Docker')
  .version(pkg.version)
	.option('--stack-name', 'The eq8db stack name deployed in Docker')
	.option('--docker-host <uri>', 'Docker host to connect to')
  .parse(process.argv);

const _ = require('lodash');
const options = _.pick(program, [
	'dockerHost'
]);

const defaults = require('../defaults.json');
const env = _.defaultsDeep(Object.create(process.env), {
	HTTP_PORT: options.httpPort,
	DOCKER_HOST: options.dockerHost
}, defaults);

const spawn = require('child_process').spawn;

const path = require('path');
const composeFilepath = path.join(__dirname, '../docker-compose.yml');

const status = spawn('docker-compose', ['-f', composeFilepath, 'ps'], { env });

status.stdout.on('data', data => {
	process.stdout.write(data);
});

status.on('close', code => {
	process.exit(code);
});
